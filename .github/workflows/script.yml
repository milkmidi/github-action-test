name: Script Test
on:
  push:
    branches:
      - dev
  
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - uses: actions/github-script@v7
        with:
          node-version: '20.x'
      - name: script
        env:
          MOCK_KEY: ${{ secrets.MOCK_KEY }}
          SLACK_HOOK_URL: ${{ secrets.SLACK_HOOK_URL }}
        with:
          script: |
            const mockKey = process.env.MOCK_KEY;
            if( mockKey === 'mock123') {
              console.log('Mock key is set correctly');
            } else {
              throw new Error('Mock key is not set correctly');
            }
            const fetch = require('node-fetch');
            const slackWebhookUrl = process.env.SLACK_HOOK_URL;
            const payload = {
              text: 'ğŸš€ å»ºç«‹èˆ‡éƒ¨ç½²æµç¨‹å·²åŸ·è¡Œå®Œæˆï¼'
            };
            if (slackWebhookUrl) {
              fetch(slackWebhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              })
                .then(res => {
                  if (!res.ok) throw new Error('Slack ç‰©ä»¶å‚³é€å¤±æ•—');
                  console.log('Slack ç‰©ä»¶å‚³é€æˆåŠŸ');
                })
                .catch(err => {
                  console.error('Slack ç‰©ä»¶å‚³é€éŒ¯èª¤:', err);
                });
            } else {
              console.warn('æœªè¨­å®š SLACK_WEBHOOK_URLï¼Œç•¥é Slack é€šçŸ¥');
            }